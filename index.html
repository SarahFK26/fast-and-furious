<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Fast & Furious ‚Äì Traffic Weave</title>

<style>
body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
}
canvas {
    border: 3px solid white;
    display: block;
    margin: auto;
    background: black;
}
button {
    padding: 10px 20px;
    font-size: 16px;
    margin: 10px;
}
</style>
</head>
<body>

<h1>üèéÔ∏è Fast & Furious ‚Äì Traffic Weave</h1>
<div>
    <strong id="track">Bane: Los Angeles</strong> |
    Poeng: <span id="score">0</span>
</div>

<button onclick="startGame()">‚ñ∂ Start</button>
<p>‚¨Ö ‚û° = Styr | T / Space = Bytt bane</p>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* üåç BANER MED EGEN HINDERTYPE */
const tracks = [
    {
        name: "Los Angeles",
        road: "#333",
        edge: "#777",
        speed: 3,
        obstacles: [
            { w: 8, h: 8, color: "#f1c40f" }, // kjegler
            { w: 12, h: 22, color: "#e74c3c" }  // sm√• biler
        ]
    },
    {
        name: "Miami",
        road: "#00bcd4",
        edge: "#2ed573",
        speed: 3,
        obstacles: [
            { w: 10, h: 10, color: "#ffffff" }, // strandting
            { w: 14, h: 24, color: "#ff7675" }
        ]
    },
    {
        name: "Tokyo",
        road: "#0b0014",
        edge: "#ff00ff",
        speed: 4,
        obstacles: [
            { w: 6, h: 18, color: "#00ffea" },  // smale sperringer
            { w: 10, h: 30, color: "#ff0055" }  // raske biler
        ]
    },
    {
        name: "London",
        road: "#2f3640",
        edge: "#718093",
        speed: 4,
        obstacles: [
            { w: 10, h: 16, color: "#dcdde1" },
            { w: 12, h: 26, color: "#273c75" }
        ]
    },
    {
        name: "Norwegian Fjords",
        road: "#1e3799",
        edge: "#81ecec",
        speed: 3,
        obstacles: [
            { w: 8, h: 12, color: "#a4b0be" }, // steiner
            { w: 10, h: 18, color: "#ced6e0" }  // isblokker
        ]
    }
];

let trackIndex = 0;
let track = tracks[0];

/* üöó SPILLER */
const player = {
    x: 200,
    y: 480,
    width: 26,
    height: 52,
    velocity: 0
};

/* üöß HINDRINGER */
let obstacles = [];
let score = 0;
let running = false;

/* üéÆ INPUT */
let leftPressed = false;
let rightPressed = false;

document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") leftPressed = true;
    if (e.key === "ArrowRight") rightPressed = true;

    if (e.key.toLowerCase() === "t" || e.code === "Space") {
        switchTrack();
    }
});

document.addEventListener("keyup", e => {
    if (e.key === "ArrowLeft") leftPressed = false;
    if (e.key === "ArrowRight") rightPressed = false;
});

/* üõ£Ô∏è VEI */
function drawRoad() {
    ctx.fillStyle = track.road;
    ctx.beginPath();
    ctx.moveTo(80, 600);
    ctx.lineTo(160, 0);
    ctx.lineTo(240, 0);
    ctx.lineTo(320, 600);
    ctx.closePath();
    ctx.fill();

    ctx.strokeStyle = track.edge;
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(80, 600);
    ctx.lineTo(160, 0);
    ctx.moveTo(320, 600);
    ctx.lineTo(240, 0);
    ctx.stroke();
}

/* üöß HINDER PER BANE */
function spawnObstacle() {
    const o = track.obstacles[
        Math.floor(Math.random() * track.obstacles.length)
    ];

    obstacles.push({
        x: 150 + Math.random() * 100,
        y: -40,
        width: o.w,
        height: o.h,
        speed: track.speed + Math.random() * 1, // Langsommere
        color: o.color
    });
}

/* üí• KOLLISJON */
function collision(a, b) {
    return (
        a.x < b.x + b.width &&
        a.x + a.width > b.x &&
        a.y < b.y + b.height &&
        a.y + a.height > b.y
    );
}

/* üîÅ BANEBYTTE ‚Äì LETT */
function switchTrack() {
    trackIndex = (trackIndex + 1) % tracks.length;
    track = tracks[trackIndex];
    document.getElementById("track").innerText = "Bane: " + track.name;
}

/* ‚ñ∂ START */
function startGame() {
    running = true;
    obstacles = [];
    score = 0;
    player.x = 200;
    player.velocity = 0;

    trackIndex = 0;
    track = tracks[0];
    document.getElementById("track").innerText = "Bane: " + track.name;

    update();
}

/* üîÑ GAME LOOP */
function update() {
    if (!running) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawRoad();

    /* Myk styring */
    if (leftPressed) player.velocity -= 0.35;
    if (rightPressed) player.velocity += 0.35;
    player.velocity *= 0.9;

    player.x += player.velocity;
    player.x = Math.max(115, Math.min(255, player.x));

    /* Spiller */
    ctx.fillStyle = "red";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    /* Hindringer */
    obstacles.forEach(o => {
        o.y += o.speed;
        ctx.fillStyle = o.color;
        ctx.fillRect(o.x, o.y, o.width, o.height);

        if (collision(player, o)) {
            running = false;
            alert("üí• KR√ÜSJ!\nPoeng: " + score);
        }
    });

    obstacles = obstacles.filter(o => o.y < 650);

    /* Mye f√¶rre hindringer og saktere */
    if (Math.random() < 0.08) spawnObstacle(); // F√¶rre hindringer

    score++;
    document.getElementById("score").innerText = score;

    requestAnimationFrame(update);
}
</script>

</body>
</html>
